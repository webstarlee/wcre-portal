<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta charset="utf-8" />
    <title>Admin Portal - Documents</title>
    <link rel="icon" type="image/png" href="/static/icons/cropped_logo.png" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static', filename='css/documents.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/icons.css') }}"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300&display=swap"
      rel="stylesheet"
    />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="{{ url_for('static', filename='js/documents.js') }}"></script>
  </head>
  <body>
    <div class="container-fluid root-div">
      {% include 'sidebar.html' %}
      <div class="d-flex justify-content-end">
        <div class="card-wrapper">
          <div class="d-flex justify-content-between gap-lg-5">
            <h2 class="greeting mt-5">{{ greeting_msg }}</h2>
            <div class="position-relative flex-shrink-0">
              <button
                id="upload-document-button"
                class="btn btn-primary mt-3 end-0 d-none d-lg-block position-relative"
                type="button"
              >
                Upload Document
              </button>
              <div
                class="position-relative d-flex d-lg-none flex-column align-items-end"
              >
                <button
                  type="button"
                  class="z-3 d-block d-lg-none navbar-toggler top-0 end-0 pr-2 pt-2"
                  data-bs-toggle="collapse"
                  data-bs-target="#open-menu"
                  aria-expanded="false"
                  aria-controls="open-menu"
                  onclick="document.getElementById('open-menu').classList.toggle('d-none')"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="24"
                    height="24"
                    class="bi"
                    fill="currentColor"
                    viewBox="0 0 16 16"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M2.5 11.5A.5.5 0 0 1 3 11h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4A.5.5 0 0 1 3 7h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4A.5.5 0 0 1 3 3h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"
                    ></path>
                  </svg>
                </button>
                <div
                  id="open-menu"
                  class="d-none bg-light d-lg-none w-100 position-relative justify-content-end"
                >
                  <button
                    id="upload-document-button"
                    class="btn btn-primary end-0 top-0 position-relative"
                    type="button"
                  >
                    Upload Document
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="row mt-4 g-4">
            {% for document_type in document_types %}
            <div class="col-12 col-sm-6 col-md-4 col-lg-3">
              <div class="card h-100">
                <div class="card-body">
                  <h5 class="card-title">{{ document_type }}</h5>
                  <p class="card-text">
                    <span class="card-number"
                      >{{ document_counts[document_type] }}</span
                    >
                    Documents
                  </p>
                </div>
                <div class="card-footer">
                  <a
                    href="{{ url_for('get_documents', document_type=document_type) }}"
                    class="btn btn-primary"
                    ><i class="fas fa-eye"></i> View</a
                  >
                </div>
              </div>
            </div>
            {% endfor %}
          </div>

          <div class="modal" id="document-modal">
            <div class="modal-content">
              <span class="close">&times;</span>
              <h3 class="modal-title">Document Files - {{ document_type }}</h3>
              <ul class="document-list">
                {% for document in documents %}
                <li>{{ document.document_name }}</li>
                {% endfor %}
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div id="error-notification" class="error-notification"></div>
    <div id="success-notification" class="success-notification"></div>
    <div id="upload-document-modal" class="modal">
      <div id="error-notification-modal" class="error-notification-modal"></div>
      <div
        id="success-notification-modal"
        class="success-notification-modal"
      ></div>
      <div class="modal-content">
        <span class="close">&times;</span>
        <form
          id="submit-document-form"
          class="modal-form"
          action="{{ url_for('submit_document') }}"
          method="POST"
        >
          <div class="modal-step active-step">
            <h2 class="modal-step-title">Upload New Document</h2>
            <div class="form-group">
              <label for="document-name">Document Name:</label>
              <input
                type="text"
                id="document-name"
                name="document-name"
                required
              />
            </div>
            <div class="form-group">
              <label for="document-type">Document Type:</label>
              <select id="document-type" name="document-type" required>
                <option value="Office Collaterals">Office Collaterals</option>
                <option value="Industrial Collaterals">
                  Industrial Collaterals
                </option>
                <option value="Investment Collaterals">
                  Investment Collaterals
                </option>
                <option value="Healthcare Collaterals">
                  Healthcare Collaterals
                </option>
                <option value="Retail Collaterals">Retail Collaterals</option>
                <option value="BOV Reports">BOV Reports</option>
                <option value="Quarterly Reports">Quarterly Reports</option>
                <option value="Key Marketing Pieces">
                  Key Marketing Pieces
                </option>
              </select>
            </div>
            <div class="form-group">
              <button id="upload-document-file" type="button">
                Upload Document File
              </button>
              <input
                id="document-file"
                type="file"
                style="display: none"
                accept=".pdf"
              />
              <input
                type="hidden"
                id="document-file-base64"
                name="document-file-base64"
              />
            </div>
            <div class="modal-navigation">
              <button
                id="submit-button"
                class="minimal-button submit-step"
                type="submit"
              >
                Upload Document
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
    <script>
      $(".card-footer").on("click", function (e) {
        e.preventDefault();
        var documentType = $(this).parent().find(".card-title").text();
        $.get(
          '{{ url_for("get_documents") }}',
          { document_type: documentType },
          function (data) {
            $("#document-modal .modal-title").text(
              "Documents Files - " + documentType
            );
            var documentList = $("#document-modal .document-list");
            documentList.empty();
            for (var i = 0; i < data.length; i++) {
              var documentName = data[i].document_name;
              var downloadButton =
                '<a class="download-button" href="data:application/pdf;base64,' +
                data[i].pdf_file_base64 +
                '" download="' +
                documentName +
                '.pdf"><i class="fa fa-download"></i></a>';
              documentList.append(
                "<li>" + documentName + " " + downloadButton + "</li>"
              );
            }
            var modal = document.getElementById("document-modal");
            modal.style.display = "block";
          }
        );
      });
    </script>
  </body>
</html>
