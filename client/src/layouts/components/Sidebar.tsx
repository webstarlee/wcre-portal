import React from "react";
import { useLocation, useNavigate } from "react-router-dom";
import {
  DesktopDrawer,
  MobileDrawer,
  DrawerHeader,
  Logo,
  ListItemButtonCustom,
  ListItemTextCustom,
} from "./StyledComponents";
import { List, ListItemIcon, Box, Skeleton } from "@mui/material";
import { useRoot } from "@/hooks/RootContext";
import { useAuth } from "@/hooks/AuthContext";

import LogoImg from "@/assets/images/logo.png";
import UserImg from "@/assets/images/user.png";

interface SidebarProps {
  window?: () => Window;
}

const Sidebar: React.FC<SidebarProps> = ({ window }) => {
  const container =
    window !== undefined ? () => window().document.body : undefined;
  const { sideOpenM, toggleSideOpenM } = useRoot();
  const { user, logout, authLoading } = useAuth();
  const location = useLocation();
  const navigate = useNavigate();

  const isActivateMenu = (paths: string[]) => {
    let is_include = false;
    paths.map((path) => {
      if (location.pathname.includes(path)) {
        is_include = true;
      }
    });

    return is_include;
  };

  const handleListItemClick = (path: string) => {
    navigate(path);
    toggleSideOpenM();
  };

  const drawer = (
    <>
      <DrawerHeader>
        <Logo src={LogoImg} alt="logo" />
      </DrawerHeader>
      <List
        sx={{ width: "100%", paddingTop: "30px", flex: 1 }}
        component="nav"
        aria-labelledby="nested-list-subheader"
      >
        <ListItemButtonCustom
          onClick={() => handleListItemClick("/dashboard")}
          selected={isActivateMenu(["/dashboard"])}
        >
          <ListItemIcon sx={{ minWidth: "40px" }}>
            <svg
              width="20"
              height="20"
              viewBox="0 0 26 26"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                opacity="0.3"
                d="M1.44444 14.4444H10.1111C10.9056 14.4444 11.5556 13.7944 11.5556 13V1.44444C11.5556 0.65 10.9056 0 10.1111 0H1.44444C0.65 0 0 0.65 0 1.44444V13C0 13.7944 0.65 14.4444 1.44444 14.4444ZM1.44444 26H10.1111C10.9056 26 11.5556 25.35 11.5556 24.5556V18.7778C11.5556 17.9833 10.9056 17.3333 10.1111 17.3333H1.44444C0.65 17.3333 0 17.9833 0 18.7778V24.5556C0 25.35 0.65 26 1.44444 26ZM15.8889 26H24.5556C25.35 26 26 25.35 26 24.5556V13C26 12.2056 25.35 11.5556 24.5556 11.5556H15.8889C15.0944 11.5556 14.4444 12.2056 14.4444 13V24.5556C14.4444 25.35 15.0944 26 15.8889 26ZM14.4444 1.44444V7.22222C14.4444 8.01667 15.0944 8.66667 15.8889 8.66667H24.5556C25.35 8.66667 26 8.01667 26 7.22222V1.44444C26 0.65 25.35 0 24.5556 0H15.8889C15.0944 0 14.4444 0.65 14.4444 1.44444Z"
                fill="#000000"
              />
            </svg>
          </ListItemIcon>
          <ListItemTextCustom primary={"Dashboard"} />
        </ListItemButtonCustom>
        <ListItemButtonCustom
          onClick={() => handleListItemClick("/listings")}
          selected={isActivateMenu(["/listings"])}
        >
          <ListItemIcon sx={{ minWidth: "40px" }}>
            <svg
              width="22"
              height="23"
              viewBox="0 0 26 27"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                opacity="0.3"
                d="M25.2909 10.5305L14.4567 0.572675C14.0588 0.20428 13.5388 -3.69933e-05 12.9992 5.02395e-09C12.4596 3.70033e-05 11.9396 0.204425 11.5417 0.572875L0.709359 10.5304C0.486185 10.7359 0.307846 10.9861 0.185731 11.2652C0.063616 11.5443 0.000408691 11.846 0.000145343 12.1512V24.7594C-0.00606773 25.3098 0.187104 25.8436 0.543252 26.2601C0.746149 26.4932 0.995996 26.6799 1.27605 26.8074C1.5561 26.935 1.8599 27.0006 2.16707 26.9998H8.662C8.94932 26.9998 9.22487 26.8844 9.42803 26.679C9.63119 26.4736 9.74533 26.1951 9.74533 25.9046V19.3322C9.74533 19.0417 9.85947 18.7632 10.0626 18.5578C10.2658 18.3524 10.5413 18.237 10.8287 18.237H15.162C15.4493 18.237 15.7248 18.3524 15.928 18.5578C16.1312 18.7632 16.2453 19.0417 16.2453 19.3322V25.9046C16.2453 26.1951 16.3594 26.4736 16.5626 26.679C16.7658 26.8844 17.0413 26.9998 17.3286 26.9998H23.8363C24.1923 27.0045 24.5435 26.917 24.8566 26.7457C25.2021 26.5572 25.4908 26.2776 25.6921 25.9368C25.8934 25.5959 25.9998 25.2064 26 24.8094V12.1513C25.9997 11.8461 25.9365 11.5444 25.8144 11.2653C25.6923 10.9862 25.514 10.736 25.2909 10.5305Z"
                fill="black"
              />
            </svg>
          </ListItemIcon>
          <ListItemTextCustom primary={"Listings"} />
        </ListItemButtonCustom>

        <ListItemButtonCustom
          onClick={() => handleListItemClick("/sales")}
          selected={isActivateMenu(["/sales"])}
        >
          <ListItemIcon sx={{ minWidth: "40px" }}>
            <svg
              width="20"
              height="24"
              viewBox="0 0 26 30"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                opacity="0.3"
                d="M23.1111 7.14286H20.2222C20.2222 3.2 16.9867 0 13 0C9.01333 0 5.77778 3.2 5.77778 7.14286H2.88889C1.29278 7.14286 0.0144444 8.42143 0.0144444 10L0 27.1429C0 28.7214 1.29278 30 2.88889 30H23.1111C24.7072 30 26 28.7214 26 27.1429V10C26 8.42143 24.7072 7.14286 23.1111 7.14286ZM13 2.85714C15.3906 2.85714 17.3333 4.77857 17.3333 7.14286H8.66667C8.66667 4.77857 10.6094 2.85714 13 2.85714ZM13 17.1429C9.01333 17.1429 5.77778 13.9429 5.77778 10H8.66667C8.66667 12.3643 10.6094 14.2857 13 14.2857C15.3906 14.2857 17.3333 12.3643 17.3333 10H20.2222C20.2222 13.9429 16.9867 17.1429 13 17.1429Z"
                fill="black"
              />
            </svg>
          </ListItemIcon>
          <ListItemTextCustom primary={"Sales"} />
        </ListItemButtonCustom>

        <ListItemButtonCustom>
          <ListItemIcon sx={{ minWidth: "40px" }}>
            <svg
              width="22"
              height="22"
              viewBox="0 0 27 27"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                opacity="0.3"
                d="M1.82854 4.40876C0.944656 5.74651 0.465749 7.31098 0.449343 8.91428C0.432938 10.5176 0.87973 12.0915 1.73606 13.4471C2.59239 14.8026 3.82184 15.8822 5.27675 16.556C6.73166 17.2298 8.35017 17.4693 9.93789 17.2457C10.0319 17.2309 10.1281 17.2384 10.2187 17.2676C10.3093 17.2969 10.3918 17.347 10.4594 17.414L13.5804 20.5349C13.7206 20.6752 13.8874 20.786 14.0711 20.8608C14.2547 20.9357 14.4515 20.973 14.6498 20.9707C14.8481 20.9683 15.044 20.9263 15.2258 20.8471C15.4076 20.768 15.5718 20.6532 15.7086 20.5097C15.8522 20.3748 16.0209 20.2696 16.2052 20.1999C16.3895 20.1303 16.5856 20.0977 16.7825 20.104C16.9794 20.1102 17.1731 20.1552 17.3526 20.2364C17.5321 20.3175 17.6938 20.4333 17.8285 20.577L19.0483 21.7967C19.1886 21.9369 19.2994 22.1038 19.3742 22.2874C19.449 22.4711 19.4864 22.6679 19.484 22.8662C19.4817 23.0645 19.4397 23.2603 19.3605 23.4422C19.2813 23.624 19.1666 23.7882 19.023 23.925C18.8851 24.0714 18.778 24.2441 18.7082 24.4328C18.6384 24.6214 18.6072 24.8222 18.6167 25.0232C18.6261 25.2241 18.6759 25.4211 18.763 25.6024C18.8502 25.7838 18.9729 25.9457 19.124 26.0785L19.3175 26.272C19.5749 26.5266 19.9228 26.6688 20.2849 26.6674L24.7601 26.6674C24.9813 26.6681 25.2003 26.625 25.4048 26.5407C25.6092 26.4564 25.7949 26.3324 25.9513 26.1761C26.1076 26.0197 26.2315 25.834 26.3159 25.6296C26.4002 25.4252 26.4432 25.2061 26.4426 24.985L26.4426 20.5097C26.444 20.1476 26.3018 19.7997 26.0472 19.5423L17.1892 10.6842C17.1222 10.6166 17.0721 10.5341 17.0428 10.4435C17.0136 10.3529 17.0061 10.2567 17.0209 10.1627C17.2842 8.29152 16.9032 6.38646 15.9407 4.76042C14.9781 3.13437 13.4911 1.88403 11.724 1.21476C9.95694 0.545494 8.01477 0.497097 6.21653 1.07752C4.41829 1.65794 2.8709 2.83267 1.82854 4.40876ZM9.61822 9.84303C9.28547 10.1758 8.86151 10.4024 8.39997 10.4942C7.93843 10.586 7.46002 10.5389 7.02526 10.3588C6.59049 10.1787 6.21889 9.87375 5.95745 9.48247C5.69601 9.09119 5.55646 8.63118 5.55646 8.16059C5.55646 7.69 5.69601 7.22999 5.95745 6.83871C6.21889 6.44743 6.59049 6.14247 7.02526 5.96238C7.46002 5.78229 7.93843 5.73518 8.39997 5.82698C8.86151 5.91879 9.28547 6.1454 9.61822 6.47815C10.0644 6.92436 10.3151 7.52955 10.3151 8.16059C10.3151 8.79163 10.0644 9.39682 9.61822 9.84303Z"
                fill="black"
              />
            </svg>
          </ListItemIcon>
          <ListItemTextCustom primary={"Leases"} />
        </ListItemButtonCustom>

        <ListItemButtonCustom>
          <ListItemIcon sx={{ minWidth: "40px" }}>
            <svg
              width="20"
              height="22"
              viewBox="0 0 26 28"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                opacity="0.3"
                d="M19.0537 0C23.5156 0 26 2.492 26 6.762V21.224C26 25.564 23.5156 28 19.0537 28H6.94778C2.55667 28 0 25.564 0 21.224V6.762C0 2.492 2.55667 0 6.94778 0H19.0537ZM7.33778 19.236C6.90444 19.194 6.48556 19.39 6.25444 19.754C6.02333 20.104 6.02333 20.566 6.25444 20.93C6.48556 21.28 6.90444 21.49 7.33778 21.434H18.6622C19.2386 21.378 19.6733 20.9006 19.6733 20.342C19.6733 19.768 19.2386 19.292 18.6622 19.236H7.33778ZM18.6622 12.8506H7.33778C6.71522 12.8506 6.21111 13.342 6.21111 13.944C6.21111 14.546 6.71522 15.036 7.33778 15.036H18.6622C19.2833 15.036 19.7889 14.546 19.7889 13.944C19.7889 13.342 19.2833 12.8506 18.6622 12.8506ZM11.6552 6.51H7.33778V6.524C6.71522 6.524 6.21111 7.014 6.21111 7.616C6.21111 8.218 6.71522 8.708 7.33778 8.708H11.6552C12.2778 8.708 12.7833 8.218 12.7833 7.6006C12.7833 7 12.2778 6.51 11.6552 6.51Z"
                fill="black"
              />
            </svg>
          </ListItemIcon>
          <ListItemTextCustom primary={"Documents"} />
        </ListItemButtonCustom>

        <ListItemButtonCustom>
          <ListItemIcon sx={{ minWidth: "40px" }}>
            <svg
              width="20"
              height="22"
              viewBox="0 0 26 28"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                opacity="0.3"
                fillRule="evenodd"
                clipRule="evenodd"
                d="M15.0894 27.8212C13.9617 28.0391 12.2575 28.0638 11.0954 27.8622C10.8092 27.8128 10.5118 27.5463 10.4307 27.2672L9.67691 24.6707C9.5958 24.3917 9.32637 24.0473 9.07511 23.9021L6.34395 22.3239C6.0927 22.1787 5.66105 22.1218 5.38089 22.1969L2.80822 22.8871C2.52806 22.9623 2.14862 22.8428 1.96169 22.6211C1.24289 21.769 0.426201 20.3494 0.051884 19.3316C-0.0483379 19.0591 0.033238 18.668 0.233682 18.458L2.1682 16.4388C2.36864 16.2293 2.53179 15.8233 2.53179 15.5325V12.3755C2.53179 12.0853 2.36538 11.6826 2.16027 11.4772L0.231817 9.5471C0.0267121 9.34177 -0.0581269 8.95397 0.0420949 8.68144C0.131595 8.43831 0.469087 7.71405 0.874636 7.01125C1.28904 6.29305 1.75752 5.62526 1.93466 5.41386C2.12065 5.19126 2.50056 5.06666 2.78258 5.1362L5.53472 5.81286C5.81627 5.88192 6.24932 5.82032 6.50058 5.67519L9.23127 4.09647C9.48253 3.95134 9.74777 3.60554 9.82282 3.32507L10.5183 0.726225C10.5934 0.445761 10.8866 0.178829 11.1728 0.130296C12.2239 -0.047036 13.8429 -0.045636 14.922 0.148496C15.2073 0.199829 15.5 0.469094 15.5751 0.749559L16.2645 3.32507C16.3396 3.60554 16.6048 3.95134 16.8556 4.09647L19.5868 5.67519C19.838 5.82032 20.2697 5.87726 20.5498 5.80212L23.1225 5.11193C23.4026 5.0368 23.7821 5.1558 23.969 5.37746C24.7186 6.26599 25.5521 7.73271 25.932 8.79764C26.0294 9.07157 25.9422 9.4603 25.7371 9.66563L23.9271 11.4772C23.722 11.6826 23.5555 12.0853 23.5555 12.3755V15.5325C23.5555 15.8233 23.722 16.2255 23.9271 16.4309L25.7642 18.27C25.9693 18.4753 26.0574 18.8645 25.9609 19.1384C25.8541 19.4418 25.4947 20.2267 25.0561 20.9878C24.6417 21.706 24.1732 22.3738 23.9961 22.5857C23.8096 22.8078 23.4306 22.9277 23.1505 22.8526L20.7064 22.1969C20.4258 22.1218 19.9946 22.1787 19.7434 22.3239L17.0122 23.9021C16.761 24.0473 16.4962 24.3931 16.4211 24.6735L15.7415 27.2131C15.6664 27.4936 15.3742 27.7661 15.0894 27.8212ZM6.69123 13.9995C6.69123 10.5145 9.51702 7.68511 12.9982 7.68511C16.4789 7.68511 19.3052 10.5145 19.3052 13.9995C19.3052 17.4841 16.4789 20.3135 12.9982 20.3135C9.51702 20.3135 6.69123 17.4841 6.69123 13.9995Z"
                fill="black"
              />
            </svg>
          </ListItemIcon>
          <ListItemTextCustom primary={"Settings"} />
        </ListItemButtonCustom>
      </List>
    </>
  );

  return (
    <>
      <DesktopDrawer
        container={container}
        variant="persistent"
        anchor="left"
        open={true}
      >
        {drawer}
        <Box>
          <ListItemButtonCustom
            sx={{ padding: "10px", backgroundColor: "#d2e0fa" }}
            onClick={logout}
          >
            <ListItemIcon sx={{ minWidth: "50px" }}>
              {user && !authLoading ? (
                <img
                  src={user ? user.avatar : UserImg}
                  style={{ width: "40px", height: "40px", borderRadius: "50%" }}
                />
              ) : (
                <Skeleton
                  animation="wave"
                  sx={{ bgcolor: "white.500" }}
                  variant="circular"
                  width={40}
                  height={40}
                />
              )}
            </ListItemIcon>
            <ListItemTextCustom
              sx={{
                flex: 1,
                margin: 0,
                "& span": {
                  fontSize: "15px",
                  fontFamily: "SatoshiBold",
                  color: "#0156FB",
                },
                "& p": {
                  fontSize: "12px",
                  fontFamily: "SatoshiMedium",
                  color: "#000",
                },
              }}
              primary={
                user && !authLoading ? (
                  user.fullname
                ) : (
                  <Skeleton variant="rectangular" width={110} height={20} />
                )
              }
              secondary={
                user && !authLoading ? (
                  user.role
                ) : (
                  <Skeleton
                    variant="rectangular"
                    width={60}
                    height={13}
                    sx={{ marginTop: "2px" }}
                  />
                )
              }
            />
            <ListItemIcon sx={{ minWidth: "30px" }}>
              <svg
                width="20"
                height="20"
                viewBox="0 0 20 20"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M20 3V17C20 17.7956 19.6839 18.5587 19.1213 19.1213C18.5587 19.6839 17.7956 20 17 20H5C4.20435 20 3.44129 19.6839 2.87868 19.1213C2.31607 18.5587 2 17.7956 2 17V14C2 13.7348 2.10536 13.4804 2.29289 13.2929C2.48043 13.1054 2.73478 13 3 13C3.26522 13 3.51957 13.1054 3.70711 13.2929C3.89464 13.4804 4 13.7348 4 14V17C4 17.2652 4.10536 17.5196 4.29289 17.7071C4.48043 17.8946 4.73478 18 5 18H17C17.2652 18 17.5196 17.8946 17.7071 17.7071C17.8946 17.5196 18 17.2652 18 17V3C18 2.73478 17.8946 2.48043 17.7071 2.29289C17.5196 2.10536 17.2652 2 17 2H5C4.73478 2 4.48043 2.10536 4.29289 2.29289C4.10536 2.48043 4 2.73478 4 3V6C4 6.26522 3.89464 6.51957 3.70711 6.70711C3.51957 6.89464 3.26522 7 3 7C2.73478 7 2.48043 6.89464 2.29289 6.70711C2.10536 6.51957 2 6.26522 2 6V3C2 2.20435 2.31607 1.44129 2.87868 0.87868C3.44129 0.316071 4.20435 0 5 0H17C17.7956 0 18.5587 0.316071 19.1213 0.87868C19.6839 1.44129 20 2.20435 20 3ZM8.29 13.29C8.19627 13.383 8.12188 13.4936 8.07111 13.6154C8.02034 13.7373 7.9942 13.868 7.9942 14C7.9942 14.132 8.02034 14.2627 8.07111 14.3846C8.12188 14.5064 8.19627 14.617 8.29 14.71C8.38296 14.8037 8.49356 14.8781 8.61542 14.9289C8.73728 14.9797 8.86799 15.0058 9 15.0058C9.13201 15.0058 9.26272 14.9797 9.38458 14.9289C9.50644 14.8781 9.61704 14.8037 9.71 14.71L13.71 10.71C13.8037 10.617 13.8781 10.5064 13.9289 10.3846C13.9797 10.2627 14.0058 10.132 14.0058 10C14.0058 9.86799 13.9797 9.73728 13.9289 9.61542C13.8781 9.49356 13.8037 9.38296 13.71 9.29L9.71 5.29C9.5217 5.1017 9.2663 4.99591 9 4.99591C8.7337 4.99591 8.4783 5.1017 8.29 5.29C8.1017 5.4783 7.99591 5.7337 7.99591 6C7.99591 6.2663 8.1017 6.5217 8.29 6.71L10.59 9H1C0.734784 9 0.48043 9.10536 0.292893 9.29289C0.105357 9.48043 0 9.73478 0 10C0 10.2652 0.105357 10.5196 0.292893 10.7071C0.48043 10.8946 0.734784 11 1 11H10.59L8.29 13.29Z"
                  fill="#0156FB"
                />
              </svg>
            </ListItemIcon>
          </ListItemButtonCustom>
        </Box>
      </DesktopDrawer>
      <MobileDrawer
        container={container}
        variant="temporary"
        open={sideOpenM}
        onClose={toggleSideOpenM}
        ModalProps={{
          keepMounted: true, // Better open performance on mobile.
        }}
      >
        {drawer}
      </MobileDrawer>
    </>
  );
};

export default Sidebar;
